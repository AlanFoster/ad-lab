---

#################################################################################
# Dev Packages
#################################################################################

- hosts: all
  name: 'Install dev packages'
  become: false
  gather_facts: false

  tasks:
    #################################################################################
    # Git
    #################################################################################

    - name: Install git
      chocolatey.chocolatey.win_chocolatey:
        name: git
        package_params:
          - /GitAndUnixToolsOnPath
          - /NoAutoCrlf
        state: present

    #################################################################################
    # Language Packages - i.e. for payload testing
    #################################################################################

    - name: Install python
      chocolatey.chocolatey.win_chocolatey:
        name:
          - python
        state: present

    - name: Install php
      chocolatey.chocolatey.win_chocolatey:
        name:
          - php
        state: present

    - name: Install openjdk
      chocolatey.chocolatey.win_chocolatey:
        name:
          - openjdk
        state: present

    #################################################################################
    # Other Packages
    #################################################################################

    - name: Install procmon - Process monitoring for finding DLL path injections etc
      chocolatey.chocolatey.win_chocolatey:
        name:
          - procmon
        state: present

    - name: Install everything.exe - Fast alternative to using the default file explorer
      chocolatey.chocolatey.win_chocolatey:
        name:
          - everything
        state: present

    # Extract build number for powertools
    - name: Extract windows build number
      ansible.windows.win_shell: '[Environment]::OSVersion.Version.Build'
      register: win_build_number
      changed_when: false

    # Install powertools only if available on the target host
    - name: Install Powertools - for multiple quality of life improvements. Install skipped if win_build_number less than 17134
      chocolatey.chocolatey.win_chocolatey:
        name:
          - everything
        state: present
      when: (win_build_number | int) >= 17134
